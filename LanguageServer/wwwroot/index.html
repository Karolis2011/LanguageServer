<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<style>
		#consolebuffer, #output {
			white-space: pre-wrap;
			font-family: Consolas, monaco, monospace; 
		}
		
		#source {
			width: 100%;
			height: 6em;
		}
	</style>
	
	
    <script>
        var programId = null;
        
		function console_log(o) {
			if(typeof o != "string")
				o = JSON.stringify(o)
			$("#output").append(`[${Date()}] ${o}\r\n`)
		}
		
		
		function get_version() {
			$.ajax({
				url: "/api/jint/version",
				dataType: "json",
				success: (data) => {
					$("#version").text(data.message)
					console_log(data)
				}
			})
		} 
		
		function create_program() {
			if(programId != null)
				return;
			$.ajax({
				type: "POST",
				url: "/api/jint/new",
				dataType: "json",
				success: (data) => {
					$("#version").text(data.message)
					console_log(data.program)
					programId = data.program.id
				}
			})
		}
		
		function fetch_program() {
			if(programId == null)
				return;
			$.ajax({
				type: "get",
				url: `/api/jint/${programId}`,
				dataType: "json",
				success: (data) => {
					$("#version").text(data.message)
					console_log(data.program)
					$("#consolebuffer").text(data.program.consoleBuffer)
				}
			})
		}
		
		
		function exec_program() {
			if(programId == null)
				return;
			$.ajax({
				type: "post",
				url: `/api/jint/${programId}/exec`,
				dataType: "json",
				data: {
					code: $("#source").val()
				},
				success: (data) => {
					$("#version").text(data.message)
					console_log(data.program)
					$("#consolebuffer").text(data.program.consoleBuffer)
				}
			})
		}
		
		function reset_program() {
			if(programId == null)
				return;
			$.ajax({
				type: "post",
				url: `/api/jint/${programId}/delete`,
				dataType: "json",
				success: (data) => {
					$("#version").text(data.message)
					$("#consolebuffer").text("")
					$("#output").text("")
					programId = null;
				}
			})
		}
		
    </script>
</head>
<body>
    <button onClick="get_version()">Try Connect</button>
	<button onClick="create_program()">Create new program</button>
	<button onClick="fetch_program()">Refresh</button>
	<button onClick="exec_program()">Execute</button>
	<button onClick="reset_program()">Clean</button>
	<hr>
    <h4 id="version"></h4>
	<textarea id="source">
__cb_log("Testing")
if(5 * 3)
  __cb_log(2^8)
</textarea>
	<hr>
	<div id="consolebuffer"></div>
	<hr>
	<div id="output"></div>
</body>
</html>